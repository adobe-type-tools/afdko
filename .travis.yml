matrix:
  include:
    - os: linux
      python: 2.7

    - os: osx
      language: generic


sudo: required

#before_install:

install:
#  - pip install --upgrade pip
  - if [ "$TRAVIS_OS_NAME" == "osx" ]; then
      curl -O https://bootstrap.pypa.io/get-pip.py;
      python get-pip.py --user;
      python -m pip install --user virtualenv;
      python -m virtualenv .venv/;
      source .venv/bin/activate;
      pip install codecov;
      pip install collective.checkdocs;
      pip install pygments;
      pip install flake8;
    fi
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then
      sudo apt-get install g++-multilib;
    fi
  - pip install --upgrade wheel cython

script:
  - if [ "$TRAVIS_OS_NAME" == "osx" ]; then
      python setup.py checkdocs;
      python setup.py check --restructuredtext --strict;
    fi
  - python setup.py bdist_wheel
  - pip install dist/*.whl
  - if [ "$TRAVIS_OS_NAME" == "osx" ]; then
      flake8 setup.py;
      cd afdko/Tools/SharedData/FDKScripts;
      flake8 buildCFF2VF.py;
      flake8 buildMasterOTFs.py;
      flake8 CheckOutlinesUFO.py;
      flake8 ConvertFontToCID.py;
      flake8 FDKUtils.py;
      flake8 MakeOTF.py;
      flake8 ufoTools.py;
      coverage run --source=. CheckOutlinesUFO.py --test;
    fi
  - pip uninstall --yes afdko

after_success:
  - if [ "$TRAVIS_OS_NAME" == "osx" ]; then
      codecov;
    fi

notifications:
  slack: typekit:TRAVIS_SLACK_TOKEN
  email:
    on_success: change
    on_failure: always
